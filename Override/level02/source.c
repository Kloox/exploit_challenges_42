#include <stdbool.h>
#include <stdint.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>



int main(int argc, char ** argv) {
    FILE *file;
    int  items_read;
    char buffer_user[100] = {0};
    char buffer_file[42] = {0};
    char buffer_password[100] = {0};

    file = fopen("/home/users/level03/.pass", "r");
    if (file == NULL) {
        fwrite("ERROR: failed to open password file\n", 1, 36, stderr);
        exit(1);
    }

    items_read = fread(buffer_file, 1, 41, file);
    buffer_file[strcspn(buffer_file, "\n")] = '\0';

    if (items_read != 41) {
        fwrite((int64_t *)"ERROR: failed to read password file\n", 1, 36, stderr);
        fwrite((int64_t *)"ERROR: failed to read password file\n", 1, 36, stderr);
        exit(1);
    }

    fclose(file);

    puts("===== [ Secure Access System v1.0 ] =====");
    puts("/***************************************\\");
    puts("| You must login to access this system. |");
    puts("\\**************************************/");

    printf("--[ Username: ");

    fgets(buffer_user, 100, stdin);

    buffer_user[strcspn(buffer_user, "\n")] = '\0';
    

    printf("--[ Password: ");
    
    fgets(buffer_password, 100, stdin);

    buffer_password[strcspn(buffer_password, "\n")] = '\0';

    puts("*****************************************");

    if (strncmp(buffer_file, buffer_password, 41) == 0) {
        printf("Greetings, %s!\n", buffer_user);
        system("/bin/sh");
        return 0;
    }
    printf(buffer_user);
    puts(" does not have access!");
    exit(1);
}
