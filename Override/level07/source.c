#include <stdbool.h>
#include <stdint.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

char clear_stdin(void)
{
    char c;
    while (true)
    {
        c = getchar();
        if (c == 10)
            break;
        if (c == -1)
            break;
    }
    return c;
}

unsigned int get_unum(void)
{
    unsigned int result = 0;
    fflush(stdin);
    scanf("%u", &result);
    clear_stdin();
    return result;
}

int store_number(unsigned int *data)
{
    int number = 0;
    int index = 0;
    printf(" Number: ");
    number = get_unum();
    printf(" Index: ");
    index = get_unum();

    if ((index % 3 == 0) || (number >> 24 == 183))
    {
        puts(" *** ERROR! ***");
        puts("   This index is reserved for wil!");
        puts(" *** ERROR! ***");
        // 0x80486d5
        return 1;
    }
    data[index] = number;
    return 0;
}

int read_number(unsigned int *data)
{
    unsigned int index = 0;
    printf(" Index: ");
    index = get_unum();
    printf(" Number at data[%u] is %u\n", index, data[index]);
    return 0;
}

int main(int argc, char **argv)
{
    char str[20] = {0};
    int code = 0;
    unsigned int data[100] = {0};

    puts("----------------------------------------------------\n\
          Welcome to wil's crappy number storage service!     \n\
          ----------------------------------------------------\n\
          Commands:                                           \n\
              store - store a number into the data storage    \n\
              read  - read a number from the data storage     \n\
              quit  - exit the program                        \n\
          ----------------------------------------------------\n\
          wil has reserved some storage :>                    \n\
          ----------------------------------------------------\n");
    while (true)
    {
        code = 1;
        printf("Input command: ");
        fgets(str, 20, stdin);
        str[19] = '\0';
        if (!strncmp(str, "store", 5))
            code = store_number(data);
        else if (!strncmp(str, "read", 4))
            code = read_number(data);
        else if (!strncmp(str, "quit", 4))
            break;
        if (code)
            printf(" Failed to do %s command\n", str);
        else
            printf(" Completed %s command successfully\n", str);
        memset(str, 0, 20);
    }
    return (0);
}
