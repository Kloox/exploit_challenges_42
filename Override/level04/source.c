#include <signal.h>
#include <stdbool.h>
#include <stdint.h>
#include <stdio.h>
#include <sys/prctl.h>
#include <sys/wait.h>
#include <unistd.h>

int main(int argc, char ** argv) {
    int32_t pid = fork();
    char str[32];
    int ptrace_return = 0;

    memset(str, '\0', 32);

    int stat_loc = 0;
    if (pid == 0) {
        prctl(PR_SET_PDEATHSIG, 1);
        ptrace(0);
        puts("Give me some shellcode, k");
        gets(str);
        return 0;
    }
    else
    {
        while (true) {
            wait(&stat_loc);
            if ((stat_loc & 0x7f) != 0) {
                puts("child is exiting...");
                return (0);
            }
	    ptrace_return = ptrace(3, pid, 44, 0);
	    if (ptrace(3) == 11) {
		break;
            }
        }
        puts("no exec() for you");
        kill(pid, SIGKILL);
    }
    return 0;
}

