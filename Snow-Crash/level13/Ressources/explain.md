# LEVEL13

We can see that we have to fake our uid to 4242.

2 solutions here :

---
- GDB:

  No symbols so we disassemble the main function
```
   0x0804858c <+0>:     push   %ebp
   0x0804858d <+1>:     mov    %esp,%ebp
   0x0804858f <+3>:     and    $0xfffffff0,%esp
   0x08048592 <+6>:     sub    $0x10,%esp
   0x08048595 <+9>:     call   0x8048380 <getuid@plt>
   0x0804859a <+14>:    cmp    $0x1092,%eax
   0x0804859f <+19>:    je     0x80485cb <main+63>
   0x080485a1 <+21>:    call   0x8048380 <getuid@plt>
   0x080485a6 <+26>:    mov    $0x80486c8,%edx
   0x080485ab <+31>:    movl   $0x1092,0x8(%esp)
   0x080485b3 <+39>:    mov    %eax,0x4(%esp)
   0x080485b7 <+43>:    mov    %edx,(%esp)
   0x080485ba <+46>:    call   0x8048360 <printf@plt>
   0x080485bf <+51>:    movl   $0x1,(%esp)
   0x080485c6 <+58>:    call   0x80483a0 <exit@plt>
   0x080485cb <+63>:    movl   $0x80486ef,(%esp)
   0x080485d2 <+70>:    call   0x8048474 <ft_des>
   0x080485d7 <+75>:    mov    $0x8048709,%edx
   0x080485dc <+80>:    mov    %eax,0x4(%esp)
   0x080485e0 <+84>:    mov    %edx,(%esp)
   0x080485e3 <+87>:    call   0x8048360 <printf@plt>
   0x080485e8 <+92>:    leave
   0x080485e9 <+93>:    ret
```

We can see the call of ```getuid``` at **0x08048595** and the comparison between **$0x1092 (4242)** and **%eax** at **0x0804859a**

We set a breakpoint before cmp : ``` b *0x0804859a```
We set **%eax** to **0x1092**
```set $eax=0x1092```

Then ```continue```

```your token is 2A31L79asukciNyi8uppkEuSx```


---------
- LD_PRELOAD trick

Ater inspect we see ```getuid()```
Let's fake getuid() using **LD_PRELOAD** trick
If you set **LD_PRELOAD** to the path of a shared object, that file will be loaded before any other library (including the C runtime, libc.so)

Copy **level13** to **/tmp** to remove **setuid bits**

Create a fake getuid()
```
#include<unistd.h>
uid_t getuid(void)
{
    return 4242;
}
```
Then create a lib from it.
```gcc -fPIC -shared -o lib.so getuid.c```
```export LD_PRELOAD="/tmp/lib.so"``` (fake lib)

Then exec /tmp/level13

It will use our fake getuid() which return 4242 and give us our token.
